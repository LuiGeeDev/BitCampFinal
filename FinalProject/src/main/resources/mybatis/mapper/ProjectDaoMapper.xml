<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="kr.or.bit.dao.ProjectDao">
  <select id="selectMyProject" resultType="kr.or.bit.model.Project">
    SELECT id, project_name, start_date, end_date, season, course_id
    FROM project
    WHERE course_id = (SELECT course_id
	            	   FROM member
			           WHERE username = #{username})    
  </select>
  <select id="selectProject" resultType="kr.or.bit.model.Project">
    SELECT id, project_name, start_date, end_date, season, course_id
    FROM project
    WHERE id = #{id}
  </select>
  <insert id="insertProject">
  	INSERT INTO PROJECT(PROJECT_NAME, START_DATE, END_DATE, SEASON, COURSE_ID)
  	VALUES (#{project_name}, 
  	        #{start_date}, 
  	        #{end_date},
  	        (SELECT IFNULL(MAX(season),0)+1 
  		     FROM PROJECT p
  		     WHERE COURSE_ID=#{course_id}),
  		    #{course_id})
  </insert>
  <select id="selectRecentProject" resultType="kr.or.bit.model.Project">
  	SELECT ID, PROJECT_NAME, START_DATE, END_DATE, SEASON, COURSE_ID
  	FROM PROJECT
  	WHERE ID=(SELECT MAX(ID) FROM PROJECT WHERE COURSE_ID=#{course_id})
  </select>
</mapper>

